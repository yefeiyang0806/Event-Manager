{% extends "bootstrap/base.html" %}
{% block title %}Place Events{% endblock %}
{% block body %}
  {{super()}}
  <link href="{{url_for('static', filename='css/dashboard.css')}}" rel="stylesheet">
  <link href="{{url_for('static', filename='jquery-timepicker/jquery.timepicker.css')}}" rel="stylesheet">
  <link href="{{url_for('static', filename='jqwidgets/jqwidgets/styles/jqx.base.css')}}" rel="stylesheet">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <style>
    .ui-dialog {
      z-index: 1050;
    }
    .dropdown-content > ul > li {
      list-style-type: none;
    }
    .dropdown-content > ul > li input {
      margin-right: 10px;
      font-family: Sans-serif;
      /*font-size: 150%;*/
    }
  </style>
  {% set active_list = 'PT' %}
  {% include 'public/navbar.html' %}
  <div class="container-fluid">
  	<div class="row">
  		{% include 'public/side_bar.html' %}
    	<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        <h1 class="page-header">Place Topics</h1>
        <br />
        <div class='row' style='text-align:center;'>
          <table class='filter-table' width="90%">
            <tr>
              <td align='center' width='40%'>
                <label class='control-label' for='content-filter'>Content: </label>
                <div class="form-group" style='margin-right:10%;'>
                  <div class='form-control dropdown-checkbox'>
                    <div class='dropdown-trigger'>
                      <a href="javascript:void(0)">
                        <span class="hida">Select Content</span>    
                        <p class="multiSel"></p>  
                      </a>
                    </div>
              
                    <div class='dropdown-content' id='dropdown-content' style='position:relative;z-index:2;'>
                      <ul style='background-color:white;'>
                        {% for c_name in content_names %}
                          <li>
                            <input type='checkbox' name='selected_contents[]' class='content-checkbox' id='{{ c_name.id }}' value='{{ c_name.id}}'>{{ c_name.name }}
                          </li>
                        {% endfor %}
                      </ul>
                    </div>
                  </div>
                </div>



              </td>
              <td align='center' width='40%'>
                <label class='control-label' for='format-filter'>Format: </label>
                <div class="form-group" style='margin-left:10%;margin-right:10%;'>
                  <div class='form-control dropdown-checkbox'>
                    <div class='dropdown-trigger'>
                      <a href="javascript:void(0)">
                        <span class="hida">Select Format</span>    
                        <p class="multiSel"></p>  
                      </a>
                    </div>
              
                    <div class='dropdown-content' id='dropdown-content' style='position:relative;z-index:2;'>
                      <ul style='background-color:white;'>
                        {% for f_name in format_names %}
                          <li>
                            <input type='checkbox' name='selected_formats[]' class='format-checkbox' id='{{ f_name.id }}' value='{{ f_name.id}}'>{{ f_name.name }}
                          </li>
                        {% endfor %}
                      </ul>
                    </div>
                  </div>
                </div>


              </td>
              <!-- <td align='center'>
                <label class='control-label' for='location-filter'>Location: </label>
                <select id='location-filter'>
                  <option selected>------Any------</option>
                  {% for l in locations %}
                    <option>{{ l }}</option>
                  {% endfor %}
                </select>
              </td> -->
              <td rowspan=2>
                <button class='btn btn-primary' id='set_filter'>Search</button>
              </td>
            </tr>
            <tr>
              <td colspan=3>
                <div class="col-xs-12 col-sm-6 col-md-6" style='z-index:1;margin-left:3%;'>
                  <div class='input-group'>
                    <label for='keyword'>Title:</lable>
                    <input type='text' class='form-control' size=50 id='keyword'/>
                  </div>
                </div>
              </td>
            <tr><td colspan=3 style='padding-left:15px;'><hr></td></tr>
            <tr id='filter_notice'>
              <td colspan=4 style='padding-left:15px;'>
                <div class="panel panel-warning">
                  <div class="panel-heading">
                    Please set filter conditions
                  </div>
                  <div class="panel-body">
                    Please select a content and/or format type and press "search".<br/>
                    <b>Warning</b>: Large number of unscheduled topics would result in 'Not Responding'. 
                  </div>
                </div>
              </td>
            </tr>
            <tr><td colspan=4><button class='btn btn-info' id='reset_schedule'>Reset schedule records</button></td></tr>
          </table>
        </div>
        <br>
        <div id='scheduler_wrapper'>
          <div id='scheduler' width='100%'></div>
        </div>
        <div class='row' style='text-align:center;margin-top:20px;'>
          <table width="90%">
            <tr>
              <td>
                <button class='btn btn-info' id='scheduler_update' >Update Schedule</button>
              </td>
              <td>
                <input type="button" value="Export to XML" id='xmlExport' />
              </td>
              <td>
                <input type="button" value="Export to iCal" id='icalExport' />
              </td>
            </tr>
          </table>
        </div>
        <div id="dialog" style='display:none;' title="Modifications are detected!">
          <p>Unsaved Modifications have been detected on the current scheduler.<br />
            Refreshing the scheduler would discard these changes.</p>
        </div>
        <div id="dialog_reset" style='display:none;' title="Do you want to reset the scheduler?">
          <p>Once reset, all records in the current scheduler would be removed.<br />
            Are you sure you want to reset the scheduler?</p>
        </div>
        <div style='display:none;' id='err_msgs' title='Conflicts Detected'></div>
        <meta name="csrf-token" content="{{ csrf_token() }}"></meta>
      </div>
    </div>
  </div>

  <script src="{{url_for('static', filename='js/jquery-1.11.3.js')}}"></script>
  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <script src="{{url_for('static', filename='jquery-timepicker/jquery.timepicker.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxcore.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxbuttons.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxscrollbar.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxdata.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxdata.export.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxdate.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxscheduler.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxscheduler.api.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxdatetimeinput.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxmenu.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxcalendar.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxtooltip.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxwindow.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxcheckbox.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxlistbox.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxdropdownlist.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxnumberinput.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxradiobutton.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxinput.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/globalization/globalize.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/globalization/globalize.culture.de-DE.js')}}"></script>
  <script src="{{url_for('static',filename='js/topic_scheduler.js')}}"></script>
  <script>
    $(document).ready(function() {

      $('.dropdown-content ul').css('display', 'none');

      $('input[type="checkbox"]').each(function(){
        if ($(this).is(':checked')) {
          if ($(this).closest('.dropdown-checkbox').find('.hida').length){
            $(this).closest('.dropdown-checkbox').find(".hida").remove();
          }
          var clicked = $(this).val();
          clicked = $.trim(clicked) + ', ';
          var html = '<span title="' + clicked + '">' + clicked + '</span>';
          $(this).closest('.dropdown-checkbox').find('.multiSel').append(html);
        }
      });
  
      $('.dropdown-trigger').click(function(){
        $(this).next().children('ul').slideToggle('fast');
      });

      $('.dropdown-content input[type="checkbox"]').click(function(){
        var clicked = $(this).val();
        clicked = $.trim(clicked) + ', ';
        if ($(this).is(':checked')) {
          var html = '<span title="' + clicked + '">' + clicked + '</span>';
          $(this).closest('.dropdown-checkbox').find('.multiSel').append(html);
          // console.log($(this).closest('.dropdown-checkbox').children('.multiSel'));
          $(this).closest('.dropdown-checkbox').find(".hida").remove();
        }
        else{
          $('span[title="' + clicked + '"]').remove();
          if ($(this).closest('.dropdown-checkbox').find('.multiSel').children().length==0){
            $(this).closest('.dropdown-checkbox').find('a').prepend('<span class="hida">Select Content</span>');
          }
        }
      });

      $(document).bind('click', function(e) {
        var $clicked = $(e.target);
        if (!$clicked.parents().hasClass("dropdown-checkbox") && !$clicked.parents().hasClass("dropdown-content")){
          $(".dropdown-content ul").hide();
        }
      });
    });
  </script>

    
{% endblock %}