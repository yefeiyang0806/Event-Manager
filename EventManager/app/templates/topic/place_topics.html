{% extends "bootstrap/base.html" %}
{% block title %}Place Events{% endblock %}
{% block body %}
  {{super()}}
  <link href="{{url_for('static', filename='css/dashboard.css')}}" rel="stylesheet">
  <link href="{{url_for('static', filename='jquery-timepicker/jquery.timepicker.css')}}" rel="stylesheet">
  <link href="{{url_for('static', filename='jqwidgets/jqwidgets/styles/jqx.base.css')}}" rel="stylesheet">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  {% set active_list = 'place_events' %}
  {% include 'public/navbar.html' %}
  <div class="container-fluid">
  	<div class="row">
  		{% include 'public/side_bar.html' %}
    	<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        <h1 class="page-header">Place Events</h1>
        <br />

        <div class='row' style='text-align:center;'>
          <table class='filter-table' width="90%">
            <tr>
              <td align='center'>
                <label class='control-label' for='content-filter'>Content: </label>
                <select id='content-filter'>
                    <option selected>----Any----</option>
                  {% for c_name in content_names %}
                    <option>{{ c_name }}</option>
                  {% endfor %}
                </select>
              </td>
              <td align='center'>
                <label class='control-label' for='format-filter'>Format: </label>
                <select id='format-filter'>
                  <option selected>--------Any--------</option>
                  {% for f_name in format_names %}
                    <option>{{ f_name }}</option>
                  {% endfor %}
                </select>
              </td>
              <td align='center'>
                <label class='control-label' for='location-filter'>Location: </label>
                <select id='location-filter'>
                  <option selected>------Any------</option>
                  {% for l in locations %}
                    <option>{{ l }}</option>
                  {% endfor %}
                </select>
              </td>
              <td>
                <button class='btn btn-primary' id='set_filter'>Search</button>
              </td>
            </tr>
          </table>
        </div>
        <br>

        <!-- <div class="table-responsive">
          {% if not events %}
			      <div class="panel panel-warning">
            	<div class="panel-heading">
              	<h2 class="panel-title">No event records yet.</h2>
              </div>
              <div class="panel-body">
              	You can <a href="/event/create">register new events here</a>.<br />
              	More actions are available on the left-hand side navigator bar.
              </div>
          	</div>
		  	  {% else %}
          	{% for event in events %}
          	  <table class="table-arrange table-striped">
          	    <tbody>
          	      <tr>
          	      	<td><strong>{{ event.topic }}</strong></td>
                    <td>Speaker: {{ event.speaker }}</td>
                    <td>Format: {{event.format_type.name }}</td>
          	      	<td>Content: {{event.content_type.name}}</td>
          	      </tr>
                  <form id='schedule_info' method='POST' action='/event/set_arrangement'>
          	      <tr>
          	      	<td>Audience: {{ event.min_attendance }} - {{ event.max_attendance }}</td>
          	      	<td>Time From: <input class='time-from' id='{{ event.uuid }}'></td>
                    <td>Time From: <input class='time-to' id='{{ event.uuid }}'></td>
                    <td>Resource: <input class='assign-resource' id='{{ event.uuid }}'></td>
          	      </tr>
          	    </tbody>
          	  </table>
          	  <br />
          	    
          	{% endfor %}
          {% endif %}
        </div> -->
        <div id='scheduler'></div>
      </div>
    </div>
  </div>

  <script src="{{url_for('static', filename='js/jquery-1.11.3.js')}}"></script>
  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <script src="{{url_for('static', filename='jquery-timepicker/jquery.timepicker.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxcore.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxbuttons.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxscrollbar.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxdata.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxdate.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxscheduler.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxscheduler.api.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxdatetimeinput.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxmenu.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxcalendar.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxtooltip.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxwindow.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxcheckbox.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxlistbox.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxdropdownlist.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxnumberinput.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxradiobutton.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/jqxinput.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/globalization/globalize.js')}}"></script>
  <script src="{{url_for('static',filename='jqwidgets/jqwidgets/globalization/globalize.culture.de-DE.js')}}"></script>
  <script>
    $(document).ready(function() {

      var appointments = new Array();
            var appointment1 = {
                id: "id1",
                description: "George brings projector for presentations.",
                location: "",
                subject: "Quarterly Project Review Meeting",
                calendar: "Room 1",
                start: new Date(2015, 10, 23, 9, 0, 0),
                end: new Date(2015, 10, 23, 16, 0, 0)
            }
            var appointment2 = {
                id: "id2",
                description: "",
                location: "",
                subject: "IT Group Mtg.",
                calendar: "Room 2",
                start: new Date(2015, 10, 24, 10, 0, 0),
                end: new Date(2015, 10, 24, 15, 0, 0)
            }
            var appointment3 = {
                id: "id3",
                description: "",
                location: "",
                subject: "Course Social Media",
                calendar: "Room 1",
                start: new Date(2015, 10, 27, 11, 0, 0),
                end: new Date(2015, 10, 27, 13, 0, 0)
            }
            var appointment4 = {
                id: "id4",
                description: "",
                location: "",
                subject: "New Projects Planning",
                calendar: "Room 2",
                start: new Date(2015, 10, 23, 0, 0, 0),
                end: new Date(2015, 10, 25, 23, 59, 59)
            }
            var appointment5 = {
                id: "id5",
                description: "",
                location: "",
                subject: "Interview with James",
                calendar: "Room 1",
                start: new Date(2015, 10, 25, 15, 0, 0),
                end: new Date(2015, 10, 25, 17, 0, 0)
            }
            var appointment6 = {
                id: "id6",
                description: "",
                location: "",
                subject: "Interview with Nancy",
                calendar: "Room 2",
                start: new Date(2015, 10, 26, 14, 0, 0),
                end: new Date(2015, 10, 26, 16, 0, 0)
            }
            appointments.push(appointment1);
            appointments.push(appointment2);
            appointments.push(appointment3);
            appointments.push(appointment4);
            appointments.push(appointment5);
            appointments.push(appointment6);
            // prepare the data
            var source =
            {
                dataType: "json",
                dataFields: [
                    { name: 'topic_id', type: 'string' },
                    { name: 'date', type: 'string' },
                    { name: 'description', type: 'string' },
                    { name: 'year', type: 'string' },
                    { name: 'topic_title', type: 'string' },
                    { name: 'resource', type: 'string' },
                    { name: 'timeFrom', type: 'string' },
                    { name: 'timeTo', type: 'string' }
                ],
                id: 'topic_id',
                url: '/topic/ajax_schedule'
            };
            var adapter = new $.jqx.dataAdapter(source);
            $("#scheduler").jqxScheduler({
                date: new $.jqx.date(2015, 11, 23),
                width: 850,
                height: 600,
                dayNameFormat: "abbr",
                source: adapter,
                showLegend: true,
                ready: function () {
                    //$("#scheduler").jqxScheduler('ensureAppointmentVisible', 'id1');
                },
                resources:
                {
                    colorScheme: "scheme05",
                    dataField: "resource",
                    orientation: "horizontal",
                    source:  new $.jqx.dataAdapter(source)
                },
                appointmentDataFields:
                {
                    from: "timeFrom",
                    to: "timeTo",
                    id: "topic_id",
                    description: "description",
                    location: "resource",
                    subject: "topic_title",
                    resourceId: "resource"
                },
                view: 'dayView',
                views:
                [
                    { type: 'dayView', showWeekends: false, timeRuler: { scaleStartHour: 7, scaleEndHour: 21 }},
                    { type: 'weekView', showWeekends: false }
                ]
            });

      $("#scheduler").on('editDialogCreate', function (event) {
        var args = event.args;
        var dialog = args.dialog;
        var fields = args.fields;
        var appointment = args.appointment;
        console.log(fields['subject'].val('Hello'));
      });


      $("#set_filter").click(function(){
        var suffix = "";
        var content_name = $("#content-filter").find(":selected").text();
        var format_name = $("#format-filter").find(":selected").text();
        var location = $("#location-filter").find(":selected").text();
        if (content_name != "----Any----"){
          suffix += "content=" + content_name;
        }
        if (format_name != "--------Any--------"){
          if (suffix != ""){
            suffix += '&';
          }
          suffix += "format=" + format_name;
        }
        if (location != "------Any------"){
          if (suffix != ""){
            suffix += '&';
          }
          suffix += "location=" + location;
        }
        $(window.location).attr('href', '/topic/validate?'+suffix);
      });
    });
  </script>
{% endblock %}